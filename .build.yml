image: alpine/latest
packages:
  - make
  - npm
  - py3-pip
sources:
  - https://git.sr.ht/~nka/blog
secrets:
  - 20d13a49-2d4e-4beb-8a4d-03b76fd55af9
  - 0ce59312-01e6-4394-9296-e6b9751c5378
tasks:
  - setup: |
      cd blog
      sudo npm install --global netlify-cli
      sudo pip install --requirement requirements.txt
      cat ~/.netlify-auth-token >> ~/.buildenv
      cat ~/.netlify-site-id >> ~/.buildenv
  - build: |
      cd blog
      make publish
  - deploy: |
      cd blog
      netlify deploy \
        --dir=output \
        --prod \
        --build
